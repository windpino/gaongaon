<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÏæåÎ≥ÄÏùò Í∏∞ÏÇ¨Îã®</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Gaegu:wght@400;700&display=swap');
        .game-font { font-family: 'Gaegu', cursive; }
        body { background-color: #f8fafc; }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- ÏïÑÏù¥ÏΩò Ïª¥Ìè¨ÎÑåÌä∏ ÏÑ§Ï†ï ---
        const Icon = ({ name, size = 24, className = "" }) => {
            useEffect(() => { if (window.lucide) window.lucide.createIcons(); }, [name]);
            return <i data-lucide={name} style={{ width: size, height: size }} className={className}></i>;
        };

        // --- ÏÉÅÏàò Î∞è Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ (ÏïÑÎ≤ÑÎãò ÏΩîÎìúÏóêÏÑú Í∞ÄÏ†∏Ïò¥) ---
        const DAILY_WATER_GOAL = 8;
        const XP_THRESHOLDS = { LEVEL_2: 100, LEVEL_3: 300 };
        const INITIAL_CHILD_DATA = [{
            profile: { id: 'child_1', username: 'gaon', password: '123', name: 'Í∞ÄÏò®', age: 7, gender: 'MALE', level: 1, xp: 0, tickets: { silver: 2, gold: 0 } },
            waterLogs: [], poopLogs: [], vegetableLogs: [], probioticsLogs: [], wonRewards: []
        }];

        // --- Î©îÏù∏ App Ïª¥Ìè¨ÎÑåÌä∏ ---
        function App() {
            // ÏïÑÎ≤ÑÎãòÏùò ÏÉÅÌÉú Í¥ÄÎ¶¨ Î°úÏßÅ ÌÜµÌï©
            const [children, setChildren] = useState(() => {
                const saved = localStorage.getItem('knight_children_data');
                return saved ? JSON.parse(saved) : INITIAL_CHILD_DATA;
            });
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [currentUserType, setCurrentUserType] = useState('CHILD');
            const [activeChildId, setActiveChildId] = useState(null);
            const [currentView, setCurrentView] = useState('HOME');
            const [loginId, setLoginId] = useState('');
            const [loginPw, setLoginPw] = useState('');

            const todayStr = new Date().toISOString().split('T')[0];
            const activeChild = children.find(c => c.profile.id === activeChildId) || children[0];

            // Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• Ìö®Í≥º
            useEffect(() => {
                localStorage.setItem('knight_children_data', JSON.stringify(children));
            }, [children]);

            // Î°úÍ∑∏Ïù∏ Ìï®Ïàò
            const handleLogin = () => {
                const child = children.find(c => c.profile.username === loginId && c.profile.password === loginPw);
                if (child) {
                    setActiveChildId(child.profile.id);
                    setIsLoggedIn(true);
                } else {
                    alert('ÏïÑÏù¥ÎîîÎÇò ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî! (ÌÖåÏä§Ìä∏Ïö©: gaon / 123)');
                }
            };

            // Î¨º ÎßàÏãúÍ∏∞ ÏóÖÎç∞Ïù¥Ìä∏ (ÏïÑÎ≤ÑÎãò Î°úÏßÅ Î∞òÏòÅ)
            const handleAddWater = () => {
                const newChildren = children.map(c => {
                    if (c.profile.id === activeChildId) {
                        const logs = [...c.waterLogs];
                        const idx = logs.findIndex(l => l.date === todayStr);
                        const currentCount = idx >= 0 ? logs[idx].count : 0;
                        if (currentCount < DAILY_WATER_GOAL) {
                            if (idx >= 0) logs[idx].count += 1;
                            else logs.push({ date: todayStr, count: 1 });
                            return { ...c, waterLogs: logs, profile: { ...c.profile, xp: c.profile.xp + 10 } };
                        }
                    }
                    return c;
                });
                setChildren(newChildren);
            };

            // --- Î°úÍ∑∏Ïù∏ ÌôîÎ©¥ ---
            if (!isLoggedIn) {
                return (
                    <div className="h-screen flex flex-col items-center justify-center bg-slate-900 text-white p-6">
                        <div className="bg-slate-800 p-8 rounded-2xl border-4 border-amber-500 shadow-2xl w-full max-w-md">
                            <h1 className="text-4xl font-bold game-font text-amber-400 text-center mb-8">üõ°Ô∏è ÏæåÎ≥ÄÏùò Í∏∞ÏÇ¨Îã®</h1>
                            <input type="text" placeholder="ÏïÑÏù¥Îîî" className="w-full bg-slate-700 p-4 rounded-xl mb-4" value={loginId} onChange={e => setLoginId(e.target.value)} />
                            <input type="password" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏" className="w-full bg-slate-700 p-4 rounded-xl mb-6" value={loginPw} onChange={e => setLoginPw(e.target.value)} />
                            <button onClick={handleLogin} className="w-full bg-amber-500 py-4 rounded-xl font-bold text-xl hover:bg-amber-400 transition">Í∏∞ÏÇ¨Îã® ÏûÖÏû•</button>
                        </div>
                    </div>
                );
            }

            // --- Î©îÏù∏ Í≤åÏûÑ ÌôîÎ©¥ ---
            const todayWater = activeChild.waterLogs.find(l => l.date === todayStr)?.count || 0;

            return (
                <div className="h-screen flex flex-col max-w-md mx-auto bg-white shadow-2xl">
                    <header className="p-4 bg-white border-b flex justify-between items-center">
                        <h2 className="game-font text-2xl text-amber-800 font-bold">üõ°Ô∏è {activeChild.profile.name} Í∏∞ÏÇ¨</h2>
                        <button onClick={() => setIsLoggedIn(false)}><Icon name="log-out" size={20} className="text-gray-400"/></button>
                    </header>

                    <main className="flex-1 p-6 space-y-6 overflow-y-auto">
                        {/* Î†àÎ≤® Î∞î */}
                        <div className="bg-amber-100 p-4 rounded-2xl">
                            <div className="flex justify-between font-bold mb-2">
                                <span>Level {activeChild.profile.level}</span>
                                <span>XP {activeChild.profile.xp}</span>
                            </div>
                            <div className="w-full bg-amber-200 h-4 rounded-full overflow-hidden">
                                <div className="bg-amber-500 h-full" style={{width: `${(activeChild.profile.xp / 100) * 100}%`}}></div>
                            </div>
                        </div>

                        {/* Î©îÏù∏ Î©îÎâ¥ Î≤ÑÌäºÎì§ */}
                        <div className="grid grid-cols-2 gap-4">
                            <button onClick={handleAddWater} className="bg-blue-500 text-white p-6 rounded-3xl shadow-lg flex flex-col items-center">
                                <Icon name="droplet" size={40} className="mb-2"/>
                                <span className="font-bold text-lg">Î¨º ÎßàÏãúÍ∏∞</span>
                                <span>{todayWater} / {DAILY_WATER_GOAL}</span>
                            </button>
                            <button className="bg-amber-500 text-white p-6 rounded-3xl shadow-lg flex flex-col items-center">
                                <Icon name="calendar" size={40} className="mb-2"/>
                                <span className="font-bold text-lg">Î∞∞Î≥Ä Í∏∞Î°ù</span>
                                <span>ÎèÑÍ∞ê Ï±ÑÏö∞Í∏∞</span>
                            </button>
                        </div>

                        <div className="bg-purple-100 p-6 rounded-3xl flex justify-between items-center">
                            <div className="flex items-center gap-3">
                                <Icon name="gift" size={30} className="text-purple-600"/>
                                <div>
                                    <p className="font-bold text-purple-900">Î≥¥ÏÉÅ ÎΩëÍ∏∞</p>
                                    <p className="text-sm text-purple-700">Ìã∞Ïºì: {activeChild.profile.tickets.silver}Í∞ú</p>
                                </div>
                            </div>
                            <button className="bg-purple-500 text-white px-4 py-2 rounded-xl font-bold">Ïù¥Îèô</button>
                        </div>
                    </main>

                    <nav className="border-t p-4 flex justify-around bg-gray-50">
                        <button className="text-amber-600 flex flex-col items-center"><Icon name="user"/><span className="text-xs font-bold">Ìôà</span></button>
                        <button className="text-gray-400 flex flex-col items-center"><Icon name="droplet"/><span className="text-xs font-bold">ÏàòÎ∂Ñ</span></button>
                        <button className="text-gray-400 flex flex-col items-center"><Icon name="calendar"/><span className="text-xs font-bold">ÎèÑÍ∞ê</span></button>
                        <button className="text-gray-400 flex flex-col items-center"><Icon name="settings"/><span className="text-xs font-bold">ÏÑ§Ï†ï</span></button>
                    </nav>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
